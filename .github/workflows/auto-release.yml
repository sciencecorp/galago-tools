name: Auto-Create Release

on:
  push:
    branches: [ main ]

jobs:
  create-release:
    runs-on: ubuntu-latest
    # Only run if commit message contains "Bump version" to identify version update commits
    if: contains(github.event.head_commit.message, 'Bump version')
    permissions:
      contents: write
      actions: write
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.9'
      
      - name: Extract version
        id: extract_version
        run: |
          # Extract version from tools/version.py
          VERSION=$(grep -oP "__version__ = ['\"]([^'\"]+)" tools/version.py | cut -d'=' -f2 | tr -d '"' | tr -d "'" | tr -d " ")
          echo "VERSION=$VERSION" >> $GITHUB_ENV
          echo "version=$VERSION" >> $GITHUB_OUTPUT
      
      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: v${{ steps.extract_version.outputs.version }}
          name: Version ${{ steps.extract_version.outputs.version }}
          draft: false
          prerelease: false
          generate_release_notes: true
      
      - name: Trigger Publish Workflow
        uses: benc-uk/workflow-dispatch@v1
        with:
          workflow: Publish Python Package
          token: ${{ github.token }}
          inputs: '{"test_mode": false, "use_test_pypi": false}' 